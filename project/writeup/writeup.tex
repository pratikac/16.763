 \documentclass[letterpaper, 10pt, twocolumn, reqno]{amsart}

\usepackage{mathpazo}
\include{./macros}
\usepackage[margin=1in]{geometry}
\linespread{1.05}

\newcommand{\algsize}{\footnotesize}
\setlength{\floatsep}{0.0in}
\setlength{\textfloatsep}{0.0in}
\setlength{\intextsep}{0.0in}
\setlength{\belowcaptionskip}{0.05in}
\setlength{\abovecaptionskip}{0.1in}
\setlength{\abovedisplayskip}{0.05in}
\setlength{\belowdisplayskip}{0.05in}

\graphicspath{{./fig/}}

\title{Column Generation Techniques in Air Transportation}
\author{Pratik Chaudhari$^*$}
\thanks{$^*$ Laboratory of Information and Decision Systems, MIT.\newline
Email: \href{pratik.ac@gmail.com}{pratik.ac@gmail.com}}
\date{May 10, 2014}

\begin{document}
\begin{abstract}
This project
\end{abstract}
\maketitle

\section{Introduction}
\label{sec:intro}

\section{Column Generation}
\label{sec:column_generation}

This section introduces column generation for solving large linear programs using the cutting-stock problem and resource-constrainted shortest path as examples. We also describe the simplex algorithm and the dual problem formulation, this will be help us to motivate as well as introduce notation for column generation.

\subsection{Linear programs: Standard form}
\label{ssec:lp_standard}

The material here is presented from~\cite{bertsimas1997introduction}. We will assume that the linear program is given to us in the standard form as follows:
\aeq{
    \trm{minimize}\ &c' x \notag \\
    \trm{subject to}\ & Ax = b \notag \\
    & x \geq 0
    \label{eqn:lp_standard_form}
}
where $c \in \reals^n$ is the cost-vector, $A = [a_{ij}] \in \reals^{m \times n}$ is the constraint matrix with $m$ constraints and $b \in \reals^m$. The columns of $A$, which we denote by $A_1, \ldots, A_n$ are also known as the resource vectors while $b$ is the target vector; motivated from
$$\sum_{i=1}^n A_i x_i =b.$$
So in the standard form, we wish to synthesize $b$ using a non-negative amount, $x_i$, of each resource $A_i$. Note that a different form of linear program, e.g., with inequality constraints can be easily converted to the standard form as follows,
\clist{
    \item if $x_i$ is unrestricted, write it as $x_i = x_i^+ - x_i^-$ where both $x_i^+, x_i^- \geq 0$;
    \item construct slack variables for inequality constraints, i.e., if $\sum_{j=1}^n a_{ij} x_j \leq b_i$, we use
    $$\sum_{j=1}^n a_{ij} x_j + s_i = b_i, \quad s_i \geq 0;$$
    \item finally, note that a maximization is just another minimization problem with a negative cost vector $c$.
}
Let $P = \cbrac{x \given Ax \geq b, -Ax \geq -b, x \geq 0}$ be a polyhedron, note that $P$ is the space of feasible candidates for Prob.~\eqref{eqn:lp_standard_form}.

\subsection{Simplex algorithm}
\label{ssec:simplex}
The simplex algorithm is based upon the observation that the optimal solution always lies on the corners of $P$. Note that since $b \in \reals^m$, if the feasible solution $x$ were of length $m$, we can just invert the corresponding rows and obtain $x$. To that end, if $x$ is a \emph{basic feasible solution}, let $B_I = \cbrac{B_1, \ldots, B_m}$ be the indices of the basic variables, i.e, $x_j = 0$ for all other indices. Let $B = \bmat{A_{B_1}, \ldots, A_{B_m}}$ be the corresponding basis matrix. we thus have,
$$
x_B = B^{-1} b
$$
where $x_B = \bmat{x_{B_1}, \ldots, x_{B_m}}$.
Let us consider moving away from $x$ to a new vector $x + \th d$ by selecting some new variable $x_j$ and making it non-zero, i.e, $d_j = 1$ for some $j \notin B_I$. Since $A(x+\th d) = b$, we need $A d = 0$ which implies
$$
0 = A d = \sum_{i=1}^n A_i d_i = \sum_{i=1}^m A_{B_i} d_{B_i} + A_j = B d_B + A_j.
$$
Since $B$ is invertible, we get $d_B = -B^{-1} A_j$. Note that for a small $\th$, the feasiblity is still maintained as we move away from $x_B$ towards $x_B + \th d$. Also, the rate of cost change by this move is
$$\bar{c}_j = c_j + c_B' d_B = c_j - c_B' B^{-1} A_j$$
which is known as the ``reduced cost'' of variable $x_j$. In other words, $\bar{c}_j$ is the change in cost incurred after a unit increase in the variable $x_j$. Of course, if this is positive for all variables in the problem, we know that we have found the solution.

The simplex algorithm then starts with a basic feasible solution and iteravtively adds new variables to this set. While doing so, we would like to pick a $\th$ s.t. $x+\th d$ is a large step, i.e.,
$$
\th^* = \max \cbrac{\th \given x + \th d \in P}.
$$
It can be shown that $\th^*$ has a simple formula
$$
\th^* = \min_{i \in [m],\ d_{B_i} < 0}\ \rbrac{- \f{x_{B_i}}{d_{B_i}}}.
$$
Thus the iteration of the simplex algorithm are simple.
\enum{
    \item Start with $A_B$ and  current basic solution $x$, compute the reduced costs $\bar{c}_j = c_j - c_B' B^{-1} A_j$ for all non-basic variables $x_j$; if all
    $\bar{c}_j \geq 0$, $x$ is optimal solution, else pick some $j$ with $\bar{c}_j < 0$.
    \item Calculate $\th^* = \min_{i \in [m],\ d_{B_i} < 0}\ \rbrac{- \f{x_{B_i}}{d_{B_i}} }$. If there is no $i$ s.t. $d_{B_i} < 0$, the optimal cost is $-\infty$.
    \item Let $l$ be the minimizing index in step 2., form a new basis by replacing $A_{B_l}$ with $A_j$ and set ${x_j \la \th^*}$ and $x_{B_i} \la x_{B_i} - \th^* d_{B_i}$.
 }
The above algorithm can be made much more efficient by passing information about dual variables in consecutive steps.

\subsection{Dual problem}
\label{ssec:dual}

We can write the Prob.~\eqref{eqn:lp_standard_form} as
\aeqs{
    \trm{minimize}\ & c'x + p'(b - Ax) \\
    \trm{subject to}\ & x \geq 0.
}
where $p \in \reals^m$ is the Lagrange multiplier. This new problem has fewer constraints and hence by definition,
\aeqs{
g(p) = \min_{x \geq 0} \sqbrac{c'x + p'(b-Ax)} &\leq c'x^* + p'(b-Ax^*) \\
&=c' x^*.
}
Here $x^*$ is the optimal solution of Prob.~\eqref{eqn:lp_standard_form} (also known as the ``primal'') and the last equality is true because $p$ at optimality is such that all constraints are satisfied. The new problem,
\aeqs{
    \trm{maximize}\ &g(p) \\
    \trm{subject to}\ &\trm{no constraints}
}
thus searches for the best lower bound of the primal. Note that
\aeqs{
g(p) = \begin{cases}
p' b \quad & \trm{if}\ c' \geq p'A\\
-\infty, \quad & \trm{otherwise}.
\end{cases}
}
Thus, the ``dual'' problem of Prob.~\eqref{eqn:lp_standard_form} is
\aeq{
    \trm{maximize}\ \quad& p' b \notag\\
    \trm{subject to}\ \quad& p'A \leq c'.
}
Dual problems are important for many reasons, viz., (i) the dual of a dual is the primal, (ii) dual solution is a lower bound for the primal's cost and finally, (iii) if the primal has a solution, so does the dual, and moreover, their costs are the same.

\subsection{Cutting-stock problem}
\label{ssec:col_gen_cutting_stock}

Consider a paper mill with a number of rolls of paper of fixed width available to it. Different customers want different numbers of rolls of various-sized widths. The problem is to them efficiently cut ``patterns'' in each roll of paper so as to avoid waste. To get an idea of the magnitude of the problem, note that European paper mills produced a total turnover of almost $\$ 75$ million in 2012 and hence saving even 1\% of this is a significant advantage.

Let the width of each roll be $W$ and $m$ customers want $n_i$ rolls each of width $w_i$. If $K$ is the number of rolls available, let $y_k = 1$ if a roll $k \in [K]$ is cut and zero otherwise. Let $x_i^k$ be the number of times item $i$ is cut on roll $k$. We then have the following formulation.
\aeq{
    (P_1) \quad \min &\sum_{k \in [K]} y_k \notag \\
    \trm{s.t.}\ & \sum_{k \in [K]} x_i^k \geq n_i \quad \forall\ i \in [m] \qquad \trm{(demand)}\notag\\
    & \sum_{i=1}^n w_i x_i^k \leq W y_k \quad \forall k \in [K]\quad \trm{(width of roll)} \notag\\
    &x_i^k \in \integers_+, y_k \in \cbrac{0,1}.
    \label{eqn:cutting_stock_ip}
}
Note that the above problem has $Kn + K$ variables and $(n+K)$ constraints and since it is an integer program, solving it for even small values of $K, n$ is expensive. The real reason for this is that the LP relaxation of this problem is bad. Note that
$$
\sum_k y_k \geq \f{1}{W} \sum_k \sum_i w_i\ x_i^k \geq \f{1}{W} \sum_i n_i\ w_i
$$
which is a naive bound and says that the number of rolls needed is simply the sum of all demands divided by $W$. Let use pose the problem in a different way as follows.

We call the set of distinct cuts of a roll as a pattern, i.e., if $W=100$, and we make 4 cuts of $w_1 = 25$ each, we generate a patterm $\{ w_1, w_1, w_1, w_1 \}$. If on the other hand, we make one cut of $w_1 =25$ and two of $w_2 = 35$, we generate a pattern $\{ w_1, w_2, w_2 \}$. Let $x_j$ be the number of times a pattern $j$ is used. Let $a_{ij}$ be the number of times item $i$ is cut in pattern $j$. Consider then, the new problem --
\aeq{
    (P_2) \quad \min &\sum_{j=1}^n x_j \notag \\
    \trm{s.t.}\ & \sum_{j=1}^n a_{ij} x_j \geq n_i \quad \forall\ i \in [m] \qquad \trm{(demand)}\notag\\
    &x_j \in \integers_+, j \in [n].
    \label{eqn:cutting_stock_pattern_ip}
}
where $n$ is the number of valid patterns, i.e., ones that satisfy $\sum_{i=1}^m w_i a_{ij} \leq W$. Note that the new problem is also an IP and moreover, it contains a huge number of variables, almost $m \choose k$, where $k$ is the average number of items in a pattern. However, let's look at its LP relaxation. We replace the integrality constraints with
$$
x_j \in \reals_+,\quad j \in [n].
$$
We call the new problem, the ``Linear Programming Master (LPM)''; the solution to this could very well be non-integral, since we have $\geq$ in the constraints we can generate a feasible, integral solution by rounding up. It has a large number of variables but only $m$ constraints. Use now use the simplex algorithm from Sec.~\ref{ssec:simplex} to solve this LP.

The main idea of column-generation is that most of variables are zero, i.e., they do not form the basis (since the basis has only as many variables as constraints). Hence, we only need a small subset of all the variables to form the solution. How do we leverage this observation? Let us start with a subset $\cP \subset [n]$ of columns of LPM and call it the ``Restricted Linear Programming Master (RLPM)''and now look at its dual problem.
\aeq{
    \trm{maximize}\ &\sum_{i=1}^m n_i \pi_i \notag \\
    \trm{subject to}\ & \sum_{i=1}^m \a_{ij} \pi_i \leq 1, \quad j \in \cP \notag\\
    &\pi \geq 0, \quad i \in [m].
    \label{eqn:cutting_stock_dual_rlpm}
}
Let $\hat{\pi}$ be the optimal solution to the dual problem. The reduced cost of column $j$ in that case is given by simply
$$
1  - \sum_{i=1}^m a_{ij}\ \hat{\pi}_i.
$$
The variable with the best reduced cost, i.e., which we absolutely must include in the primal is to find
$$
\min \cbrac{1  - \sum_{i=1}^m a_{ij}\ \hat{\pi}_i \given j \in [n] \setminus \cP}
$$
which is still expensive to do since we need to enumerate all the possible patterns. However, it is another optimization problem, and a very famous at that. This problem, which we will call as the ``sub-problem'' (or the ``pricing problem'') is a Knapsack problem, i.e.,
\aeq{
    \max \quad &\sum_{i=1}^m \hat{\pi}_i y_i \notag \\
    \trm{s.t.}\ \quad & \sum_{i=1}^m w_i y_i \leq W, \notag\\
    & y_i \in \integers_+, i \in [m].
    \label{eqn:cutting_stock_sub_problem}
}
This problem is one of the ``easy'' NP-hard problems and can be solved in $\bigo(mW)$ time by dynamic programming. We thus have a strategy for solving the cutting-stock problem as follows.
\enum{
    \item Start with some initial columns of LPM, e.g., use a simple pattern to cut rolls into $\ceil{W/w_i}$ pieces of $w_i$, $A = [a_{ij}]$ in Prob.~\eqref{eqn:cutting_stock_pattern_ip} is thus diagonal.
    \item repeat until all reduced costs are non-negative
        \enum{
            \item Solve RLPM and let $\hat{\pi}$ be the dual variables
            \item Find a new column as the solution of knapsack pricing problem with the most negative reduced cost
            \item Add new column to RLPM
        }
}

Note that this procedure only yields a solution to LPM, i.e., the relaxed problem of Prob.~\eqref{eqn:cutting_stock_pattern_ip}. In order to get an integer solution, observe that
$$
\sum_{j=1}^n a_{ij} \ceil{x_j} \geq \sum_{j=1}^n a_{ij} x_j \geq n_i
$$
which means that the rounded-up solution is also a feasible solution for Prob.~\eqref{eqn:cutting_stock_pattern_ip}. But of course, this rounded-up solution is not optimal, to obtain the optimal solution to the original IP, we have to take recourse to ``branch and bound'', which is a technique for solving general integer linear programs. In the next section, we discuss this procedure and motivate the ``branch and price'' framework which uses column generation in addition to branch and bound.

\section{Branch and Price}
\label{sec:branch_and_price}

\subsection{Airline Crew Scheduling}
\label{ssec:crew_scheduling}

\section{Maintenance routing and crew scheduling together}
\label{sec:integrated}


\section{Examples}
\label{sec:examples}

\subsection{Cutting-stock problem}
\label{ssec:eg_cutting_stock}

\subsection{Resource-constrained shortest path}
\label{ssec:eg_shortest_path}


\section{Summary}
\label{sec:summary}


{
\small
\bibliography{../writeup}
\bibliographystyle{alpha}
}
\end{document}

Typically in air transportation problems such as crew scheduling and fleet assignment, there are constraints on sequences of flights using a resource, e.g., an aircraft or a crew member. Although the number of constraints is huge, the problem can be made tractable by enumerating all possible sequences and assigning decision variables to each one of them. Column generation~\cite{desrosiers2005primer} then is a formalization of the simple idea that constraints on these sequences can be eliminated by only considering sequences that satisfy these constraints.

More formally, if the entire set of variables (columns) is unnecessary for the solution, the basis variables (cf.\@ simplex algorithm) can be generated as needed. This is akin to solving a \emph{restricted master problem} in conjunction with smaller sub-problems, also known as \emph{pricing problems}. This sub-problem, roughly speaking, finds the new basis variable by minimizing the reduced cost of each new variable using the dual variables in the restricted problem. We iterate to construct a new master problem by adding this new variable to the optimization. The efficacy of column generation (also known as \emph{branch-and-price}~\cite{barnhart1998branch} for integer programs) hinges on an efficient solution to the pricing problem. For example, in fleet assignment, maintenance routing and crew scheduling, the master problem is a \emph{set-cover problem} while the pricing problem is form of \emph{shortest path problem} which can be easily solved using dynamic programming. Various similar problems like constrained or multi-label shortest path problems are viable candidates for sub-problems in branch-and-price methods. After giving a brief overview of the algorithm, we will demonstrate an implementation of column generation techniques on canonical problems such as \emph{resource-constrained shortest path} and \emph{cutting-stock problem}. The key idea here is to express, e.g., the shortest path problem, not as a combination of individual arcs, but instead as a decision variable for whether a particular sub-path is included in the shortest path or not.

Now consider the problem of \emph{aircraft scheduling}, which we define to be the combination of four sub-problems, viz., \emph{schedule design, fleet assignment, maintenance routing} and \emph{crew scheduling}. The sheer size of each of these individual problems makes it almost impossible to solve the combined problem of aircraft scheduling, even for a small airline. Practically, there are huge advantages to be gained in terms of optimality or even robustness if we can solve the combined problem. Due to the large number of constraints, it is a promising domain for techniques like branch-and-price. In particular, we will focus on integrating aircraft maintenance and crew scheduling. As suggested in~\cite{cohn2003improving}, elements of the two problems can be integrated to ensure that only the maintenance routings that relevant to the crew scheduling problem are considered. The key idea in this approach is the notion of \emph{short connect}, which are routings that can be realized only if the crew stays on the aircraft. Evidently, a set of short connects can represent numerous different routings, which is crucial for a quick solution to the problem. We will present results of computational experiments using column generation on formulations that integrate the two problems. These formulations typically involve solving an integer linear program using branch-and-bound techniques, while the LP relaxation is solved using column generation; the pricing problem in this case will be a multi-label shortest path problem.
